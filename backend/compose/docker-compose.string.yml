services:
  # White Profile
  nmap_white:
    image: instrumentisto/nmap
    profiles: [ "white" ]
    command: -sT -F -oX /data/nmap_white.xml ${TARGET}
    volumes:
      - ${HOST_DATA_DIR}:/data
    network_mode: bridge

  testssl:
    image: drwetter/testssl.sh
    user: root
    profiles: [ "white" ]
    command: --jsonfile /data/testssl.json ${TARGET}
    volumes:
      - ${HOST_DATA_DIR}:/data
    network_mode: bridge

  dirsearch:
    image: python:3.9-slim
    profiles: [ "white" ]
    command: sh -c "pip install dirsearch && dirsearch -u ${TARGET} --format=json -o /data/dirsearch.json"
    volumes:
      - ${HOST_DATA_DIR}:/data
    network_mode: bridge

  nikto_white:
    build:
      context: ./nikto
      dockerfile: Dockerfile
    profiles: [ "white" ]
    command: -h ${TARGET} -o /data/nikto_white.json
    volumes:
      - ${HOST_DATA_DIR}:/data
    network_mode: bridge

  # Gray Profile
  nmap_gray:
    image: instrumentisto/nmap
    profiles: [ "gray" ]
    command: -sV -sC -oX /data/nmap_gray.xml ${TARGET}
    volumes:
      - ${HOST_DATA_DIR}:/data
    network_mode: bridge

  wpscan:
    image: wpscan/wpscan
    profiles: [ "gray" ]
    command: --url ${TARGET} --format json -o /data/wpscan.json --disable-tls-checks
    volumes:
      - ${HOST_DATA_DIR}:/data
    network_mode: bridge

  zap:
    image: zaproxy/zap-stable
    profiles: [ "gray" ]
    user: root
    # ZAP requires a writable dir
    command: zap-baseline.py -t ${TARGET} -J /data/zap.json
    volumes:
      - ${HOST_DATA_DIR}:/data
      - ${HOST_DATA_DIR}:/zap/wrk
    network_mode: bridge

  sslyze:
    image: nablas/sslyze
    profiles: [ "gray" ]
    command: --json_out=/data/sslyze.json ${TARGET}
    volumes:
      - ${HOST_DATA_DIR}:/data
    network_mode: bridge

  # Black Profile
  nmap_black:
    image: instrumentisto/nmap
    profiles: [ "black" ]
    command: -A -oX /data/nmap_black.xml ${TARGET}
    volumes:
      - ${HOST_DATA_DIR}:/data
    network_mode: bridge

  nuclei:
    image: projectdiscovery/nuclei
    profiles: [ "black" ]
    command: -u ${TARGET} -json -o /data/nuclei.json
    volumes:
      - ${HOST_DATA_DIR}:/data
    network_mode: bridge

  nikto_black:
    build:
      context: ./nikto
      dockerfile: Dockerfile
    profiles: [ "black" ]
    command: -h ${TARGET} -o /data/nikto_black.json
    volumes:
      - ${HOST_DATA_DIR}:/data
    network_mode: bridge

  # Merge Service (Alpine based, no build needed)
  merge:
    image: alpine
    container_name: pentaas_merge
    command: sh -c "echo 'Scanning contents of ${DATA_DIR}...' && ls -l /app/reports/session/data && echo 'Scan Summary for ${TARGET}' > /app/reports/session/data/scan_summary.txt && echo 'Files found:' >> /app/reports/session/data/scan_summary.txt && ls -1 /app/reports/session/data >> /app/reports/session/data/scan_summary.txt"
    volumes:
      - ${HOST_DATA_DIR}:/app/reports/session/data
    environment:
      - TARGET=${TARGET}
      - DATA_DIR=/app/reports/session/data
    network_mode: bridge
