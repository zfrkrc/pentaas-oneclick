services:
  frontend:
    build: ./frontend
    ports:
      - "${HOST_IP:-127.0.0.1}:${NGINX_PORT:-80}:80"
    volumes:
      - ./reports:/reports:ro
    depends_on:
      - backend

  backend:
    build: ./backend
    env_file: .env
    environment:
      - HOST_REPORTS_PATH=${PWD}/reports
      - TURNSTILE_SECRET_KEY=0x4AAAAAACgficT-CDwiOh1QoNmv-YjobnA
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - ./reports:/app/reports
      - ./backend/compose:/app/compose:ro
    restart: unless-stopped

  worker:
    build: ./backend
    command: python worker.py
    env_file: .env
    environment:
      - HOST_REPORTS_PATH=${PWD}/reports
      - REDIS_URL=${REDIS_URL:-redis://172.16.16.80:6379}
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - ./reports:/app/reports
      - ./backend/compose:/app/compose:ro
    restart: unless-stopped

  # Tool Microservices
  nmap-service:
    build:
      context: ./backend
      dockerfile: services/nmap/Dockerfile
    ports:
      - "8001:8000"
    environment:
      - SERVICE_NAME=nmap
      - RESULTS_DIR=/data/results
    volumes:
      - ./reports:/data/results
    restart: unless-stopped

  nuclei-service:
    build:
      context: ./backend
      dockerfile: services/nuclei/Dockerfile
    ports:
      - "8002:8000"
    environment:
      - SERVICE_NAME=nuclei
    volumes:
      - ./reports:/data/results
    restart: unless-stopped

  testssl-service:
    build:
      context: ./backend
      dockerfile: services/testssl/Dockerfile
    ports:
      - "8003:8000"
    environment:
      - SERVICE_NAME=testssl
    volumes:
      - ./reports:/data/results
    restart: unless-stopped

  dirsearch-service:
    build:
      context: ./backend
      dockerfile: services/dirsearch/Dockerfile
    ports:
      - "8004:8000"
    environment:
      - SERVICE_NAME=dirsearch
    volumes:
      - ./reports:/data/results
    restart: unless-stopped

  nikto-service:
    build:
      context: ./backend
      dockerfile: services/nikto/Dockerfile
    ports:
      - "8005:8000"
    environment:
      - SERVICE_NAME=nikto
    volumes:
      - ./reports:/data/results
    restart: unless-stopped

  whatweb-service:
    build:
      context: ./backend
      dockerfile: services/whatweb/Dockerfile
    ports:
      - "8006:8000"
    environment:
      - SERVICE_NAME=whatweb
    volumes:
      - ./reports:/data/results
    restart: unless-stopped

  arjun-service:
    build:
      context: ./backend
      dockerfile: services/arjun/Dockerfile
    ports:
      - "8007:8000"
    environment:
      - SERVICE_NAME=arjun
    volumes:
      - ./reports:/data/results
    restart: unless-stopped

  dalfox-service:
    build:
      context: ./backend
      dockerfile: services/dalfox/Dockerfile
    ports:
      - "8008:8000"
    environment:
      - SERVICE_NAME=dalfox
    volumes:
      - ./reports:/data/results
    restart: unless-stopped

  wafw00f-service:
    build:
      context: ./backend
      dockerfile: services/wafw00f/Dockerfile
    ports:
      - "8009:8000"
    environment:
      - SERVICE_NAME=wafw00f
    volumes:
      - ./reports:/data/results
    restart: unless-stopped

  dnsrecon-service:
    build:
      context: ./backend
      dockerfile: services/dnsrecon/Dockerfile
    ports:
      - "8010:8000"
    environment:
      - SERVICE_NAME=dnsrecon
    volumes:
      - ./reports:/data/results
    restart: unless-stopped

  wpscan-service:
    build:
      context: ./backend
      dockerfile: services/wpscan/Dockerfile
    ports:
      - "8011:8000"
    environment:
      - SERVICE_NAME=wpscan
    volumes:
      - ./reports:/data/results
    restart: unless-stopped

  zap-service:
    build:
      context: ./backend
      dockerfile: services/zap/Dockerfile
    ports:
      - "8012:8000"
    environment:
      - SERVICE_NAME=zap
    volumes:
      - ./reports:/data/results
    restart: unless-stopped

  sslyze-service:
    build:
      context: ./backend
      dockerfile: services/sslyze/Dockerfile
    ports:
      - "8013:8000"
    environment:
      - SERVICE_NAME=sslyze
    volumes:
      - ./reports:/data/results
    restart: unless-stopped
